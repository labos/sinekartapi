<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="counter">
  <resultMap class="it.tlogic.aoo.model.Counter" id="abatorgenerated_CounterResult" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Wed Mar 21 17:27:12 CET 2012.
    -->
    <result column="ID" jdbcType="BIGINT" property="id" />
    <result column="LASTVALUE" jdbcType="BIGINT" property="lastvalue" />
    
  </resultMap>
  
  <select id="abatorgenerated_selectByPrimaryKey" parameterClass="it.tlogic.aoo.model.Counter" resultMap="abatorgenerated_CounterResult">
    select ID, LASTVALUE
    from COUNTER
    where ID = #id:BIGINT#
  </select>

  <select id="selectByAoo" parameterClass="java.lang.String" resultMap="abatorgenerated_CounterResult" >
	<![CDATA[

    select COUNTER.ID, COUNTER.LASTVALUE
    FROM COUNTER_HAS_AOO, COUNTER, AOO
	WHERE 
    	AOO.NAME  = #value:VARCHAR#
    	AND AOO.ID = COUNTER_HAS_AOO.AOO_ID
    	AND COUNTER_HAS_AOO.DT_INI_VAL <= CURRENT_DATE AND COUNTER_HAS_AOO.DT_END_VAL > CURRENT_DATE
    	AND COUNTER.ID = COUNTER_HAS_AOO.COUNTER_ID
    	]]>
  </select>

  <delete id="abatorgenerated_deleteByPrimaryKey" parameterClass="it.tlogic.aoo.model.Counter">
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Wed Mar 21 17:27:12 CET 2012.
    -->
    delete from COUNTER
    where ID = #id:BIGINT#
  </delete>
  
  <insert id="abatorgenerated_insert" parameterClass="it.tlogic.aoo.model.Counter" >
    insert into COUNTER (LASTVALUE)
    values (#lastvalue:BIGINT#)
    
     <selectKey keyProperty="id" resultClass="long">  
            SELECT CURRVAL('counter_id_seq') AS ID  
      </selectKey>  
	
  </insert>
  
  <insert id="insertAoRelation" >
    insert into COUNTER_HAS_AOO (COUNTER_ID, AOO_ID, DT_INI_VAL, DT_END_VAL)
    VALUES(#COUNTER_ID:BIGINT#, (SELECT ID FROM AOO WHERE NAME = #AOO_NAME:VARCHAR#),
    	CURRENT_DATE,  to_date((EXTRACT(YEAR FROM CURRENT_DATE) + 1)::text, 'YYYY'))
  </insert>  
  
  
  
  <update id="abatorgenerated_updateByPrimaryKey" parameterClass="it.tlogic.aoo.model.Counter">
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Wed Mar 21 17:27:12 CET 2012.
    -->
    update COUNTER
    set 
      LASTVALUE = #lastvalue:BIGINT#
    where ID = #id:BIGINT#
  </update>
  
</sqlMap>